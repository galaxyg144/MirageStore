<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mirage Apps Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f4f9; color: #333; margin: 0; padding: 0; }
        header { background: #6c63ff; color: white; padding: 1rem; text-align: center; }
        main { padding: 2rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { padding: 0.75rem; text-align: left; border-bottom: 1px solid #ddd; }
        tr:hover { background: #efefef; }
        input[type="file"] { margin-top: 1rem; }
        button { background: #6c63ff; color: white; border: none; padding: 0.5rem 1rem; cursor: pointer; }
        button:hover { background: #5750d1; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <header>
        <h1>Mirage Apps Dashboard</h1>
    </header>
    <main>
        <h2>Upload a .mapp File</h2>
        <form id="uploadForm" enctype="multipart/form-data">
            <input type="file" name="file" accept=".mapp" required>
            <button type="submit">Upload</button>
        </form>
        <p id="uploadStatus"></p>

        <h2>Available Apps</h2>
        <table>
            <thead>
                <tr>
                    <th>Filename</th>
                    <th>Download</th>
                </tr>
            </thead>
            <tbody id="appsList"></tbody>
        </table>
    </main>

    <script>
        const appsList = document.getElementById("appsList");
        const uploadForm = document.getElementById("uploadForm");
        const uploadStatus = document.getElementById("uploadStatus");

        // Fetch apps
        async function fetchApps() {
            const res = await fetch("/apps");
            const files = await res.json();
            appsList.innerHTML = files.map(f => `
                <tr>
                    <td>${f}</td>
                    <td><a href="/apps/${f}" download>Download</a></td>
                </tr>
            `).join("");
        }

        // Upload form handler
        uploadForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData(uploadForm);
            uploadStatus.textContent = "Uploading...";
            try {
                const res = await fetch("/upload", { method: "POST", body: formData });
                const data = await res.json();
                if (data.success) {
                    uploadStatus.textContent = `Uploaded: ${data.filename}`;
                    uploadStatus.className = "success";
                    fetchApps();
                } else {
                    uploadStatus.textContent = data.error || "Upload failed";
                    uploadStatus.className = "error";
                }
            } catch (err) {
                uploadStatus.textContent = "Upload error";
                uploadStatus.className = "error";
            }
        });

        fetchApps();
    </script>
</body>
</html>
